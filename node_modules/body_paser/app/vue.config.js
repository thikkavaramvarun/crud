const { defineConfig } = require('@vue/cli-service')
var bodyParser = require('body-parser')
var jwt = require('jsonwebtoken');
var Mock = require('mockjs')
var shop = Mock.mock({
    // 属性 list 的值是一个数组，其中含有 1 到 10 个元素
    'list|5': [{
        "fid|+1":1,
        "text":'@cname',
        "children|100":[
          {
            // 属性 id 是一个自增数，起始值为 1，每次增 1
            'id|+1': 1,
            "title":'@ctitle',
            "price|1-100":100,
            "desc":'@cword(10,20)',
            "thumb":"https://img01.yzcdn.cn/vant/ipad.jpeg",
            'wen':'@cword(30,40)'
          }
        ]
    }]
})
module.exports = defineConfig({
  transpileDependencies: true,
  devServer: {
    setupMiddlewares: (middlewares, devServer) => {
      if (!devServer) {
        throw new Error('webpack-dev-server is not defined');
      }
      devServer.app.use(bodyParser.json())
      devServer.app.post('/login', (_, response) => {
        const obj=_.body
        const token = jwt.sign({
          data: obj
        }, 'secret', { expiresIn: '1h' });
        response.send({
          code:200,
          data:token
        });
      });

      devServer.app.get('/shop/list', (_, response) => {
        response.send({
          code:200,
          data:shop.list
        });
      });

      devServer.app.post('/shop/info', (_, response) => {
        const {id} =_.body
        var obj={}
        shop.list.forEach(element => {
          element.children.forEach(item=>{
            // console.log(item);
              if(item.id==id){
                obj=item
              }
          })
        });
        response.send({
          code:200,
          data:obj
        });
      });
      return middlewares;
    },
  },
})
